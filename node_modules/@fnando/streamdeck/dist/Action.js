"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Action = void 0;
const events_1 = require("./events");
const State_1 = require("./State");
const Target_1 = require("./Target");
class Action extends events_1.ActionEvents {
    constructor(params) {
        var _a, _b, _c;
        super();
        this.tooltip = "";
        this.hasMultiActionSupport = true;
        this.inspectorName = "";
        this.states = [];
        this.plugin = undefined;
        this.context = "";
        this.device = "";
        this.encoder = undefined;
        this.keyPad = true;
        this.enableUserTitle = true;
        this.isVisibleInActionsList = true;
        this.disableCachingImages = false;
        this.name = params.name;
        this.tooltip = (_a = params.tooltip) !== null && _a !== void 0 ? _a : "";
        this.hasMultiActionSupport = (_b = params.hasMultiActionSupport) !== null && _b !== void 0 ? _b : true;
        this.inspectorName = (_c = params.inspectorName) !== null && _c !== void 0 ? _c : "";
        this.states = params.states.map((s) => new State_1.State(Object.assign({ action: this }, s)));
    }
    get uuid() {
        return `${this.plugin.id}.${this.constructor.name.toLowerCase()}`;
    }
    toManifest() {
        var _a;
        const snippet = {
            Icon: `images/actions/${this.constructor.name}`,
            UUID: this.uuid,
            Name: this.name + (__DEV__ ? " (dev)" : ""),
            States: this.states.map((s) => s.toManifest()),
        };
        const controllers = [];
        if (this.encoder !== undefined) {
            controllers.push("Encoder");
        }
        if (this.keyPad === true) {
            controllers.push("KeyPad");
        }
        snippet.Controllers = controllers;
        const optionals = [
            [
                "PropertyInspectorPath",
                this.inspectorName,
                `inspectors/${this.inspectorName}.html`,
            ],
            ["Tooltip", this.tooltip, this.tooltip],
            [
                "SupportedInMultiActions",
                this.hasMultiActionSupport === false,
                this.hasMultiActionSupport,
            ],
            ["Encoder", this.encoder !== undefined, (_a = this.encoder) === null || _a === void 0 ? void 0 : _a.toManifest()],
            [
                "UserTitleEnabled",
                this.enableUserTitle === false,
                this.enableUserTitle,
            ],
            [
                "VisibleInActionsList",
                this.isVisibleInActionsList === false,
                this.isVisibleInActionsList,
            ],
            ["DisableCaching", this.disableCachingImages, this.disableCachingImages],
        ];
        optionals.forEach(([prop, condition, value]) => {
            if (condition) {
                snippet[prop] = value;
            }
        });
        return snippet;
    }
    get id() {
        return `${this.plugin.id}.${this.constructor.name}`;
    }
    send(payload) {
        this.debug("Sending event:", payload);
        this.plugin.send(payload);
    }
    setTitle(input, { target = Target_1.Target.both, state, context, } = {
        target: Target_1.Target.both,
        context: this.context,
    }) {
        this.send({
            event: "setTitle",
            context: context,
            payload: {
                title: String(input),
                target,
                state,
            },
        });
    }
    setImage(input, { target = Target_1.Target.both, state, context, } = {
        target: Target_1.Target.both,
        context: this.context,
    }) {
        this.send({
            event: "setImage",
            context,
            payload: {
                image: String(input),
                target,
                state,
            },
        });
    }
    showAlert({ target = Target_1.Target.both, state, context, } = {
        target: Target_1.Target.both,
        context: this.context,
    }) {
        this.send({
            event: "showAlert",
            context,
            payload: {
                target,
                state,
            },
        });
    }
    setSettings(payload) {
        this.send({
            event: "setSettings",
            context: this.context,
            payload,
        });
        this.getSettings();
    }
    getSettings() {
        this.send({
            event: "getSettings",
            context: this.context,
        });
    }
    setGlobalSettings(payload) {
        this.send({
            event: "setGlobalSettings",
            context: this.plugin.uuid,
            payload,
        });
        this.getGlobalSettings();
    }
    getGlobalSettings() {
        this.send({
            event: "getGlobalSettings",
            context: this.plugin.uuid,
        });
    }
    logMessage(message) {
        this.send({
            event: "logMessage",
            payload: { message },
        });
    }
    sendToPropertyInspector(payload) {
        this.send({
            action: this.id,
            event: "sendToPropertyInspector",
            context: this.context,
            payload,
        });
    }
    openURL(url) {
        this.send({
            event: "openUrl",
            payload: { url },
        });
    }
    showOK({ target = Target_1.Target.both, state, context, } = {
        target: Target_1.Target.both,
        context: this.context,
    }) {
        this.plugin.send({
            event: "showOk",
            context,
            payload: {
                target,
                state,
            },
        });
    }
    setState(state) {
        this.plugin.send({
            event: "setState",
            context: this.context,
            payload: { state },
        });
    }
    switchToProfile(profile) {
        this.plugin.send({
            event: "switchToProfile",
            context: this.context,
            device: this.device,
            payload: { profile },
        });
    }
    setFeedback(payload) {
        this.send({
            event: "setFeedback",
            context: this.context,
            payload,
        });
    }
    setFeedbackLayout(layout) {
        this.send({
            event: "setFeedbackLayout",
            context: this.context,
            payload: {
                layout,
            },
        });
    }
}
exports.Action = Action;
//# sourceMappingURL=Action.js.map